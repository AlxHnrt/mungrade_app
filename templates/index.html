{% extends "base.html" %}
{% block title %}MunGrade • Scoring{% endblock %}
{% block content %}
<div class="card">
<h1 style="margin:0 0 12px 0;">Moteur de scoring</h1>
<p style="margin:0 0 18px 0; color:var(--muted)">
     Évaluez une entreprise selon vos critères fondamentaux.
</p>
   {% if errors %}
<div class="card" style="border-color:#3a1f1f;background:#161214;margin-bottom:14px">
<strong style="color:#fda4af;">Erreurs dans le formulaire :</strong>
<ul>
         {% for e in errors %}<li>{{ e }}</li>{% endfor %}
</ul>
</div>
   {% endif %}
<form method="post" action="{{ url_for('score_web') }}">
<div class="form-grid">
<div>
<label for="moat">Moat</label>
<select id="moat" name="moat">
           {% set moat_val = (form.moat if form else 'Fort') %}
<option {{ 'selected' if moat_val=='Fort' }}>Fort</option>
<option {{ 'selected' if moat_val=='Faible' }}>Faible</option>
<option {{ 'selected' if moat_val=='Aucun' }}>Aucun</option>
</select>
</div>
<div>
<label for="management">Management</label>
<select id="management" name="management">
           {% set mgmt_val = (form.management if form else 'Excellent') %}
<option {{ 'selected' if mgmt_val=='Excellent' }}>Excellent</option>
<option {{ 'selected' if mgmt_val=='Correct' }}>Correct</option>
<option {{ 'selected' if mgmt_val=='Médiocre' }}>Médiocre</option>
</select>
</div>
<div>
<label for="ROE">ROE (%)</label>
<input id="ROE" name="ROE" type="number" step="0.1" value="{{ form.ROE if form else 18 }}">
</div>
<div>
<label for="DetteEBITDA">Dette / EBITDA</label>
<input id="DetteEBITDA" name="DetteEBITDA" type="number" step="0.1" value="{{ form.DetteEBITDA if form else 1.2 }}">
</div>
<div>
<label for="PER">PER</label>
<input id="PER" name="PER" type="number" step="0.1" value="{{ form.PER if form else 22 }}">
</div>
</div>
<div class="actions">
<button class="btn btn-primary" type="submit">Calculer</button>
<a class="btn btn-secondary" href="{{ url_for('playground') }}">Tester l’API</a>
</div>
</form>
</div>
 {% if result %}
<div class="card" style="margin-top:16px">
<h2 style="margin:0 0 8px 0;">Résultat</h2>
<div style="display:flex;align-items:center;gap:10px">
<div class="badge {% if result.score>=80 %}ok{% elif result.score>=60 %}warn{% else %}bad{% endif %}">
         {{ result.label }}
</div>
<div style="font-size:1.2rem">Score : <strong>{{ result.score }}</strong></div>
</div>
</div>
 {% endif %}
{% endblock %}