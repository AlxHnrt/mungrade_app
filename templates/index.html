<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>MunGrade™ - Analyse Entreprise</title>
<style>
       body { font-family: Arial, sans-serif; margin: 40px; }
       h1 { color: #2c3e50; }
       .search-container { margin-bottom: 20px; }
       .company-info { margin-top: 10px; display: flex; align-items: center; }
       .company-info img { max-height: 50px; margin-right: 10px; }
       .form-group { margin-bottom: 15px; }
       label { display: block; font-weight: bold; margin-bottom: 5px; }
       input, select { width: 200px; padding: 5px; }
       button { padding: 8px 15px; cursor: pointer; }
</style>
</head>
<body>
<h1>MunGrade™</h1>
<div class="search-container">
<label for="search">Rechercher une entreprise :</label>
<input type="text" id="search" placeholder="Ex: Rolls Royce">
<button onclick="searchCompany()">Rechercher</button>
<div id="company-display" class="company-info" style="display:none;">
<img id="company-logo" src="" alt="Logo entreprise">
<span id="company-name"></span>
</div>
</div>
<form method="POST" action="/score-web">
<div class="form-group">
<label for="moat">Moat :</label>
<select name="moat" id="moat">
<option value="Aucun">Aucun</option>
<option value="Faible">Faible</option>
<option value="Fort">Fort</option>
</select>
</div>
<div class="form-group">
<label for="management">Management :</label>
<select name="management" id="management">
<option value="Médiocre">Médiocre</option>
<option value="Correct">Correct</option>
<option value="Excellent">Excellent</option>
</select>
</div>
<div class="form-group">
<label for="ROE">ROE (%) :</label>
<input type="text" name="ROE" id="ROE">
</div>
<div class="form-group">
<label for="DetteEBITDA">Dette / EBITDA :</label>
<input type="text" name="DetteEBITDA" id="DetteEBITDA">
</div>
<div class="form-group">
<label for="PER">PER :</label>
<input type="text" name="PER" id="PER">
</div>
<button type="submit">Calculer</button>
</form>
<script>
       function searchCompany() {
           const query = document.getElementById("search").value;
           if (!query) return alert("Veuillez entrer un nom d'entreprise.");
           fetch(`/prefill?q=${encodeURIComponent(query)}`)
               .then(res => res.json())
               .then(data => {
                   if (!data.found) {
                       alert(data.message || "Entreprise introuvable.");
                       return;
                   }
                   // Afficher nom + logo
                   document.getElementById("company-display").style.display = "flex";
                   document.getElementById("company-name").innerText = data.data.companyName;
                   document.getElementById("company-logo").src = data.data.companyLogo;
                   // Préremplir formulaire
                   document.getElementById("moat").value = data.data.moat;
                   document.getElementById("management").value = data.data.management;
                   document.getElementById("ROE").value = data.data.ROE ?? "";
                   document.getElementById("DetteEBITDA").value = data.data.DetteEBITDA ?? "";
                   document.getElementById("PER").value = data.data.PER ?? "";
               })
               .catch(err => {
                   console.error(err);
                   alert("Erreur de connexion au serveur.");
               });
       }
</script>
</body>
</html>